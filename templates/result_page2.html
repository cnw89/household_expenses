{% extends "base.html" %}
{% block headcontent %}
<script src="{{ url_for('static', filename='/js/lib/echarts.js') }}"></script>
{% endblock %}
{% block description %}
<p>Complete!</p>
<p id="smallScreenAlert"></p>

<script>
    var width = window.innerWidth;
    if (width < 576){
        document.getElementById("smallScreenAlert").innerHTML=
        "<div class='alert alert-warning' role='alert'>If you are viewing this page on a smartphone, turn your phone on its side (in landscape orientation) to see this page best!</div>";
    }
</script>
<p>
    Based on the expense budget you provided with a household of {{ printout('n_adults', '', ' adults')}} and 
    {{ printout('n_children', '', ' children')}}, we estimate that an equivalent level of expenditure can be achieved 
    in other non-retired households allowing {{ printout('first_adult', '£', '')}} for the first adult, {{ printout('second_adult', '£', '')}}
    for subsequent adults, and {{ printout('child', '£', '')}} for children, per month. {% call query('Equivalization of Expenses') %} We use the OECD-modified
    equivalization factors of 1 for the first adult, 0.5 for subsequent adults and 0.3 for children. You can read about equivalization using this method
    <a href='https://en.wikipedia.org/wiki/Equivalisation' target='_blank' rel='external'>here</a>.{% endcall %}
</p>
{% endblock %}

{% block formaction %}action="/questions" method="GET"{% endblock %}

{%- macro printout(varname, prestr='', poststr='') -%}
    <strong>{{ prestr | safe }}<span id='{{ varname }}'>{{ '{:,.0f}'.format(d_common[varname]) }}</span>{{ poststr | safe }}</strong>
{%- endmacro -%}
{% macro add_chart(name, height) %}
<div class="row justify-content-center">
    <div class="col-md-11" id="{{ name  }}" style="height:{{ height }}px;"></div>
</div>
<p></p>
{% endmacro %}

{% macro query(title) %}
<a tabindex="0" class="d-inline-block" role="button" data-bs-toggle="popover" data-bs-trigger="focus" 
data-bs-original-title="{{ title }}" data-bs-content="{{ caller() | safe }}">
    <img src="{{ url_for('static', filename='img/question.svg') }}" alt="tooltip" width="24" height="24">
</a>
{% endmacro %}

{% block body %}
<div class="p-3 border bg-light">
    <h3>How much is enough?</h3><p></p>

    <p>
        For your household you have said 'enough' is {{ printout('base', '£', '/year') }}.  
        Including tax this would require a single earner with an annual salary of {{ printout('with_tax1', '£') }}, 
        or two earners each with a salary of {{ printout('with_tax2', '£') }}.
        See the graphic below for other household sizes. Expected tax is calculated with a single earner; if more than one earner is present in the household, 
        total tax will usually be less.
        {% call query('Tax Calculation') %}
        The calculated tax includes Income Tax and and Class 1A National Insurance employee contributions and a 
        fixed council tax of {{ printout('council_tax', '£', '/year') }}. Of the pension contribution, {{ printout('employer_pension_contrib_pc', '', '%') }}
        is assumed to be paid directly by the employer (and so is not part of these numbers) and the remaining pension contributions are made prior to 
        tax deductions. Tax rates are valid to April 2023.
        {% endcall %}
    </p>
    {{ add_chart('f1_chart', '300') }}
</div>
<p></p>
<div class="p-3 border bg-light">
    <h3>What does it take to earn enough?</h3><p></p>

    <p>
        For your household, for a single earner to earn enough on the UK National Living Wage  
        (the legal minimum wage for those age 23, currently {{ "£{:.2f}/hour".format(d_common['min_wage']) }}), would take {{ printout('hours_1', '', ' hours/week')}} of work.
        For two earners earning equally it would take {{ printout('hours_2', '', ' hours/week')}}.
    </p><p>
        {% if d_common.hours_1 is gt(d_common.default_hours_per_week) %}
        For a single earner to earn this in {{ d_common.default_hours_per_week }} hours/week, they would need a wage of <strong>{{ "£{:.2f}/hour".format(d_common.wage_1) }}</strong>.
        {% endif %}
        {% if d_common.hours_2 is gt(d_common.default_hours_per_week) %}
        For two earners to earn this in {{ d_common.default_hours_per_week }} hours/week each, they would need a wage of <strong>{{ "£{:.2f}/hour".format(d_common.wage_2) }}</strong>.
        {% endif %}
        Use the controls below to see what it takes for different households for different wages or hours worked per week.
    </p>

    <div class="row justify-content-between p-1 bg-white gy-2">
        <div class="col-6">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="wageHoursSwitch">
                <label class="form-check-label" for="wageHoursSwitch" id="wageHoursSwitchLabel">Fixed wage</label>
            </div>
        </div>
        <div class="col-6">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="nWorkersSwitch">
                <label class="form-check-label" for="nWorkersSwitch" id="nWorkersSwitchLabel">One earner per household</label>
            </div>                
        </div>
        
        <div class="col-12 col-sm-6">
            <div class="row">
                <label for="hoursOrWageRange" class="form-label" id="hoursOrWageRangeLabel">Hours worked per week</label>
                <div class="col-3">
                    <p class="float-end"><span id="hoursOrWageRangeMinLabel">10</span></p>
                </div>
                <div class="col-6">
                    <input type="range" class="form-range form-control" id="hoursOrWageRange" min="10.0" step="0.1" max="80.0" value="37.5">
                </div>
                <div class="col-3">
                    <span id="hoursOrWageRangeMaxLabel">80</span>
                </div>
            </div>                      
        </div>
    </div>
    <p></p>
    {{ add_chart('f2_chart', '300') }}
</div>
<p></p>
<div class="p-3 border bg-light">
    <h3>Who has enough?</h3><p></p>
    <p>
        For your 'enough', approximately <strong>{{ '{:.0f}%'.format(100 -  d_whohas.pc_individuals_without_enough) }}</strong> of UK non-retired residents have enough household income, leaving 
        <strong>{{ '{:.0f}%'.format(d_whohas.pc_individuals_without_enough) }}</strong> of non-retired residents that do not.
        {% call query('Data source') %}
        The following sections are based on Office of National Statistics data, publicly available 
        <a href='https://www.ons.gov.uk/peoplepopulationandcommunity/personalandhouseholdfinances/incomeandwealth/datasets/householddisposableincomeandinequality'
        target='_blank' rel='external'>here</a>.
        {% endcall %}
    </p>
    {{ add_chart('f3a_chart', '150') }}
    <p>
        Those with the bottom 10% of household income have on avarage <strong>{{ "{:.2f}x".format(d_whohas.pc_enough_by_decile[0]) }}</strong> enough, while those
        with the top 10% of household income have on avarage <strong>{{ "{:.2f}x".format(d_whohas.pc_enough_by_decile[-1]) }}</strong> enough.
        {% call query('Income deciles') %}
        The 10 bars in the figure represent equivalized disposable income deciles of non-retired UK residents.
        Disposable income is the income after tax and includes income from non-salary sources e.g. returns from investments.
        Households' total income is equivalized to a standard household size of two adults and no children.
        Individual non-retired UK residents are then ordered according to their household's equivalized disposable income.
        {% endcall %}

    </p>
    {{ add_chart('f3_chart', '400') }}
</div>
<p></p>
<div class="p-3 border bg-light">
    <h3>Do we have enough for everyone?</h3><p></p>
    <p>
        Total UK household disposable income is <strong>{{ "{:.2f}x".format(1/d_dowe.enough_for_everyone_ratio) }}</strong> of enough for everyone.
        The deficit between enough and current earnings for those that don't have enough is approximately 
        <strong>{{ "{:.2f}x".format(d_dowe.deficit_without_enough_ratio) }}</strong> of total UK household disposable income.
    </p>
    {{ add_chart('f4_chart', '300') }}
</div>
<p></p>
<div class="p-3 border bg-light">
    <h3>What does it take for everyone to have enough?</h3><p></p>
    <p>
        Between 1977 and 2021 the growth of the whole UK economy has been equivalent to annual growth of <strong>{{ d_willgrowth.growth_UK }}%</strong>, but 
        growth of the bottom 10%'s incomes has been closer to <strong>{{ d_willgrowth.growth_bottom }}%</strong> while those in the top 10% of incomes has been 
        <strong>{{ d_willgrowth.growth_top }}%</strong>.         
        If the bottom 10% of household disposable incomes continue to grow at an annual rate of {{ d_willgrowth.growth_bottom }}%, 
        it will take <strong>{{ "{:.1f}".format(d_willgrowth.bottom_years_to_enough) }} years</strong> before those households earn enough.
        {% call query('Growth of incomes and the UK economy') %}
        Stated here are the compound annual growth rates (CAGRs) of the bottom and top decile points of household equivalized disposable income between 
        1977 and 2021. Additionally the CAGR of UK GDP between the same years, using data from 
        <a href='https://www.ons.gov.uk/economy/grossdomesticproductgdp/timeseries/ihyp/pn2'>here</a>.
        Compound annual growth rates are explained 
        <a href='https://en.wikipedia.org/wiki/Compound_annual_growth_rate'>here</a>.
        {% endcall %}
    </p>
    <p>
        Below you can see how the rate of growth (applied evenly across all incomes) affects how much of enough different households have over the coming years.
    </p>
    <div class="row justify-content-center p-1 bg-white">
        <div class="col-7">
            <label for="growthPCRange" class="form-label" id="growthPCRangeLabel">Growth percent: 1.5%</label>
            <div class="row">
                <div class="col-2">
                    <p class="float-end">0.1%</p>
                </div>
                <div class="col-8">
                    <input type="range" class="form-range from-control" id="growthPCRange" min="0.1" step="0.1" max="5.0" value="1.5">
                </div>
                <div class="col-2">
                    5%
                </div>            
            </div>        
        </div>
    </div>
    <p></p>
    {{ add_chart('f5_chart', '400') }}
    {% if d_willgrowth.tax_found %}
    <p>
        The deficit of those without enough is equal to <strong>{{ "{:.1f}%".format(d_willgrowth.tax_rate) }}</strong> of all income above 
        <strong>{{ "{:d}x".format(d_willgrowth.tax_thresh_ratio) }}</strong> of enough.
    </p>
    {% endif %}
</div>
<p></p>
<div class="p-3 border bg-light">
    <h3>And finally...</h3><p></p>
    <p>
        If you thought this was interesting...
    </p>
</div>
<script type="text/javascript">
    {% include 'fig_howmuch.js' %} 
    {% include 'fig_whatdoes.js' %}
    {% include 'fig_whohassimple.js' %}
    {% include 'fig_whohas.js' %}
    {% include 'fig_dowe.js' %}
    {% include 'fig_whohaswithgrowth.js' %} 

</script>

{% endblock %}
{% block navbuttons %}
    <div class="row justify-content-between">
        <div class="col-2">
            <a class="btn btn-primary" href="/page1" role="button">Restart</a> 
        </div>  
        <div class="col-2">
            <p class="float-end"><input type="submit" class="btn btn-primary" value="Next"></p>
        </div>                    
    </div>
{% endblock %}
{% block progress %}100{% endblock %}